<?php		$Address = array();	$sql = "SELECT 				PessoaEndereco.IdPessoa,				PessoaEndereco.IdPessoaEndereco,				PessoaEndereco.CEP,				PessoaEndereco.Endereco,				PessoaEndereco.Numero,				PessoaEndereco.Bairro,				Cidade.NomeCidade,				Estado.SiglaEstado,				CONCAT(Cidade.NomeCidade, ' - ', Estado.SiglaEstado) CidadeUF,				CONCAT(Cidade.NomeCidade, ' - ', Estado.NomeEstado) CidadeNE,				CONCAT(Cidade.NomeCidade, ' - ', Estado.SiglaEstado, ', ', PessoaEndereco.CEP, ', ', Pais.NomePais) Address,				(TentativaMapeamento + 1) TentativaMapeamento			FROM 				PessoaEndereco,				Pais,				Estado,				Cidade,				(					SELECT 						Pessoa.IdPessoa 					FROM						Pessoa,						PessoaEndereco 					WHERE 						Pessoa.IdPessoa = PessoaEndereco.IdPessoa AND 						(							PessoaEndereco.Latitude IS NULL OR 							PessoaEndereco.Longitude IS NULL						)					ORDER BY 						RAND() 					LIMIT 						1				) Temp			WHERE 				PessoaEndereco.IdPessoa = Temp.IdPessoa AND 				PessoaEndereco.IdPais = Pais.IdPais AND 				PessoaEndereco.IdEstado = Estado.IdEstado AND 				PessoaEndereco.IdCidade = Cidade.IdCidade AND 				PessoaEndereco.TentativaMapeamento <= 10 AND 				Pais.IdPais = Estado.IdPais AND 				Pais.IdPais = Cidade.IdPais AND 				Estado.IdEstado = Cidade.IdEstado";	$res = mysql_query($sql, $con);		while($lin = mysql_fetch_array($res)) {		$Address[0] = $Address[1] = $Address[2] = $lin["Address"];		$AtualizarTentativa = true;				if(!empty($lin["Numero"])) {			$Address[0] = $lin["Numero"].", ".$Address[0];		}				if(!empty($lin["Endereco"])) {			$Address[0] = $lin["Endereco"].", ".$Address[0];			$Address[1] = $lin["Endereco"].", ".$Address[1];		}				for($i = 0; $i < count($Address); $i++) {			$json = "[".file_get_contents("http://maps.google.com/maps/api/geocode/json?address=".urlencode($Address[$i])."&sensor=true&region=IND")."]";			$obj = json_decode($json);						if(strtoupper($obj[0]->{"status"}) == "OK") {				$obj[0]->{"status"} = false;								foreach($obj[0]->{"results"} as $id_0 => $sub_class_0) {					foreach($sub_class_0->{"address_components"} as $id_1 => $sub_class_1) {						if(($sub_class_0->{"address_components"}[$id_1 - 1]->{"long_name"}." - ".$sub_class_1->{"short_name"}) == $lin["CidadeUF"]) {							$sql_up = "UPDATE 											PessoaEndereco										SET											PessoaEndereco.Latitude = '".$obj[0]->{"results"}[$id_0]->{"geometry"}->{"location"}->{"lat"}."',											PessoaEndereco.Longitude = '".$obj[0]->{"results"}[$id_0]->{"geometry"}->{"location"}->{"lng"}."'										WHERE											PessoaEndereco.IdPessoa = '".$lin["IdPessoa"]."' AND											PessoaEndereco.IdPessoaEndereco = '".$lin["IdPessoaEndereco"]."'";							mysql_query($sql_up, $con);							$AtualizarTentativa = false;							break;						}					}				}			}		}				if($AtualizarTentativa) {			$sql_up = "UPDATE 							PessoaEndereco 						SET 							TentativaMapeamento = '".$lin["TentativaMapeamento"]."'						WHERE							PessoaEndereco.IdPessoa = '".$lin["IdPessoa"]."' AND							PessoaEndereco.IdPessoaEndereco = '".$lin["IdPessoaEndereco"]."'";			mysql_query($sql_up, $con);		}	}?>